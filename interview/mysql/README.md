# mysql

## 架构

- client
- server
- storage

## storage

- innodb: B+树
- myisam

## storage engine

### 考虑

- 读
  - 键查询
  - 小范围查询（磁盘IO）
  - 范围查询
- 写
- 空间

### 对比

- 数组/链表
  - 平均复杂度O(n)，慢
- 二叉树
  - 普通二叉树平均复杂度O(logn)，最坏复杂度O(n)，不稳定
  - 平衡二叉树最坏复杂度O(logn)，但对磁盘IO不友好
- 哈希表
  - 平均复杂度O(1)，不稳定
- 跳表
  - 平均复杂度O(logn)，不稳定
- B树
  - 从根节点开始，高度保持固定，每层有多个节点，每个节点有多个键/索引
  - 数据/记录存放在内部节点和叶子节点上
  - 稳定的键查询，对磁盘IO友好，不支持范围查询
- B+树
  - 从根节点开始，高度保持固定，每层有多个节点，每个节点有多个键/索引
  - 键/索引存放在内部节点上，数据/记录存放在叶子节点上，而且每层节点使用双向链表连接
  - 稳定的键查询，对磁盘IO友好，支持范围查询
- LSM
  - 读放大：compaction，bloomfilter
  - 空间放大：compaction

## index

- 主键/聚簇索引
  - 键：主键，值：记录
- 二级索引
  - 键：索引，值：主键
  - 回表
- 联合索引
  - 键：联合索引（顺序），值：主键
  - 回表

#### 索引失效，explain

- [【MySQL】索引失效以及explain应对](https://blog.csdn.net/tr1912/article/details/81319574)
- [一张图搞懂MySQL的索引失效](https://segmentfault.com/a/1190000021464570)

## log

## transaction

- A：原子性
- C：一致性
- I：隔离性
- D：持久性

## 原子性

- log

## 一致性

- 一致性指数据库的数据无论何时都能保证某种逻辑的自洽
- 一致性主要通过下面的方式保证：
  - 事务的另外三个性质
  - 数据库的约束功能
  - 业务代码

## 隔离性

## 持久性

- log`
